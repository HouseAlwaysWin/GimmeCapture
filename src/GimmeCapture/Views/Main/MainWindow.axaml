<Window xmlns="https://github.com/avaloniaui"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:vm="using:GimmeCapture.ViewModels.Main"
        xmlns:services="using:GimmeCapture.Services.Core"
        xmlns:media="using:Avalonia.Media"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        mc:Ignorable="d" d:DesignWidth="800" d:DesignHeight="450"
        x:Class="GimmeCapture.Views.Main.MainWindow"
        x:DataType="vm:MainWindowViewModel"
        Title="{Binding AppVersion, StringFormat='GimmeCapture!! v{0}'}"
        Icon="avares://GimmeCapture/Assets/kitsune_icon.png"
        Background="{DynamicResource GothicBlackBrush}"
        FontFamily="{Binding CurrentFontFamily, Source={x:Static services:LocalizationService.Instance}}"
        xmlns:c="using:GimmeCapture.Views.Controls"
        xmlns:converters="using:GimmeCapture.Converters"
        Foreground="White"
        MinWidth="720" MinHeight="500">

    <Design.DataContext>
        <!-- This only sets the DataContext for the previewer in an IDE,
             to set the actual DataContext for runtime, set the DataContext property in code (look at App.axaml.cs) -->
        <vm:MainWindowViewModel/>
    </Design.DataContext>

    <Grid RowDefinitions="*,Auto" Margin="10">
        <!-- Settings Tabs -->
        <TabControl Grid.Row="0" x:Name="MainTabControl">
            <!-- 一般 (General) -->
            <TabItem Header="{Binding [TabGeneral], Source={x:Static services:LocalizationService.Instance}}">
                <ScrollViewer VerticalScrollBarVisibility="Auto" HorizontalScrollBarVisibility="Disabled">
                    <Grid ColumnDefinitions="*, Auto" Margin="10">
                        <!-- Settings Controls -->
                        <StackPanel Grid.Column="0" Spacing="10">
                            <CheckBox IsChecked="{Binding RunOnStartup}" Content="{Binding [RunOnStartup], Source={x:Static services:LocalizationService.Instance}}"/>
                            <CheckBox IsChecked="{Binding AutoCheckUpdates}" Content="{Binding [AutoCheckUpdates], Source={x:Static services:LocalizationService.Instance}}"/>
                            
                            <TextBlock Text="{Binding [Language], Source={x:Static services:LocalizationService.Instance}}" Margin="0,10,0,5"/>
                            <ComboBox HorizontalAlignment="Stretch"
                                      ItemsSource="{Binding AvailableLanguages}"
                                      SelectedItem="{Binding SelectedLanguageOption, Mode=TwoWay}">
                                <ComboBox.ItemTemplate>
                                    <DataTemplate x:DataType="vm:MainWindowViewModel+LanguageOption">
                                        <TextBlock Text="{Binding Name}"/>
                                    </DataTemplate>
                                </ComboBox.ItemTemplate>
                            </ComboBox>

                            <!-- Theme Color -->
                            <StackPanel Spacing="10" Margin="0,10,0,0">
                                <TextBlock Text="{Binding [ThemeColor], Source={x:Static services:LocalizationService.Instance}}" FontWeight="SemiBold"/>
                                <ItemsControl ItemsSource="{Binding SettingsColors}">
                                    <ItemsControl.ItemsPanel>
                                        <ItemsPanelTemplate>
                                            <StackPanel Orientation="Horizontal" Spacing="15"/>
                                        </ItemsPanelTemplate>
                                    </ItemsControl.ItemsPanel>
                                    <ItemsControl.ItemTemplate>
                                        <DataTemplate x:DataType="media:Color">
                                            <Button Width="40" Height="40" Padding="0" CornerRadius="20"
                                                    Background="{Binding Converter={StaticResource ColorToBrushConverter}}"
                                                    Command="{Binding $parent[Window].((vm:MainWindowViewModel)DataContext).ChangeThemeColorCommand}"
                                                    CommandParameter="{Binding}"
                                                    BorderThickness="0">
                                                <Panel>
                                                    <Border BorderBrush="White" BorderThickness="2" CornerRadius="20" Margin="-2"
                                                            IsVisible="{Binding $parent[Window].((vm:MainWindowViewModel)DataContext).ThemeColor, Converter={StaticResource ColorMatchConverter}, ConverterParameter={Binding}}"/>
                                                    <Border CornerRadius="20" BoxShadow="inset 0 0 5 0 #80000000"/>
                                                </Panel>
                                            </Button>
                                        </DataTemplate>
                                    </ItemsControl.ItemTemplate>
                                </ItemsControl>
                            </StackPanel>

                            <!-- Styling Section -->
                            <StackPanel Spacing="15" Margin="0,15,0,0">
                                <TextBlock Text="{Binding [TabSnip], Source={x:Static services:LocalizationService.Instance}}" FontWeight="SemiBold"/>
                                
                                <Grid ColumnDefinitions="Auto, Auto">
                                    <StackPanel Grid.Column="0" Spacing="15" Width="350">
                                        <!-- Border Thickness -->
                                        <StackPanel Spacing="5">
                                            <TextBlock Text="{Binding [BorderThickness], Source={x:Static services:LocalizationService.Instance}}" FontSize="12"/>
                                            <StackPanel Orientation="Horizontal" Spacing="10">
                                                <Slider Minimum="1" Maximum="9" Value="{Binding BorderThickness}" 
                                                        TickFrequency="1" IsSnapToTickEnabled="True" HorizontalAlignment="Stretch" Width="250"/>
                                                <c:CompactNumericStep Value="{Binding BorderThickness}"
                                                                      IncreaseCommand="{Binding IncreaseThicknessCommand}"
                                                                      DecreaseCommand="{Binding DecreaseThicknessCommand}"/>
                                            </StackPanel>
                                        </StackPanel>
                                        
                                        <!-- Mask Opacity -->
                                        <StackPanel Spacing="5">
                                            <TextBlock Text="{Binding [MaskOpacity], Source={x:Static services:LocalizationService.Instance}}" FontSize="12"/>
                                            <StackPanel Orientation="Horizontal" Spacing="10">
                                                <Slider Minimum="0.05" Maximum="1.0" Value="{Binding MaskOpacity}" HorizontalAlignment="Stretch" Width="250" />
                                                <c:CompactNumericStep Value="{Binding MaskOpacity}"
                                                                      IncreaseCommand="{Binding IncreaseOpacityCommand}"
                                                                      DecreaseCommand="{Binding DecreaseOpacityCommand}"/>
                                            </StackPanel>
                                        </StackPanel>

                                        <!-- Icon Scale -->
                                        <StackPanel Spacing="5">
                                            <TextBlock Text="{Binding [IconScale], Source={x:Static services:LocalizationService.Instance}}" FontSize="12"/>
                                            <StackPanel Orientation="Horizontal" Spacing="10">
                                                <Slider Minimum="0.4" Maximum="1.0" Value="{Binding CornerIconScale}" 
                                                        TickFrequency="0.1" IsSnapToTickEnabled="True" HorizontalAlignment="Stretch" Width="250"/>
                                                <c:CompactNumericStep Value="{Binding CornerIconScale}"
                                                                       IncreaseCommand="{Binding IncreaseCornerIconScaleCommand}"
                                                                       DecreaseCommand="{Binding DecreaseCornerIconScaleCommand}"/>
                                            </StackPanel>
                                        </StackPanel>

                                        <!-- Wing Scale -->
                                        <StackPanel Spacing="5">
                                            <TextBlock Text="{Binding [WingScale], Source={x:Static services:LocalizationService.Instance}}" FontSize="12"/>
                                            <StackPanel Orientation="Horizontal" Spacing="10">
                                                <Slider Minimum="0.5" Maximum="3.0" Value="{Binding WingScale}" 
                                                        TickFrequency="0.1" IsSnapToTickEnabled="True" HorizontalAlignment="Stretch" Width="250"/>
                                                <c:CompactNumericStep Value="{Binding WingScale}"
                                                                      IncreaseCommand="{Binding IncreaseWingScaleCommand}"
                                                                      DecreaseCommand="{Binding DecreaseWingScaleCommand}"/>
                                            </StackPanel>
                                        </StackPanel>
                                        
                                        <!-- Border Color -->
                                        <StackPanel Spacing="10">
                                            <TextBlock Text="{Binding [BorderColor], Source={x:Static services:LocalizationService.Instance}}" FontSize="12"/>
                                            <ItemsControl ItemsSource="{Binding SettingsColors}">
                                                <ItemsControl.ItemsPanel>
                                                    <ItemsPanelTemplate>
                                                        <StackPanel Orientation="Horizontal" Spacing="15"/>
                                                    </ItemsPanelTemplate>
                                                </ItemsControl.ItemsPanel>
                                                <ItemsControl.ItemTemplate>
                                                    <DataTemplate x:DataType="media:Color">
                                                        <Button Width="32" Height="32" Padding="0" CornerRadius="16"
                                                                Background="{Binding Converter={StaticResource ColorToBrushConverter}}"
                                                                Command="{Binding $parent[Window].((vm:MainWindowViewModel)DataContext).ChangeColorCommand}"
                                                                CommandParameter="{Binding}"
                                                                BorderThickness="0">
                                                            <Panel>
                                                                <Border BorderBrush="White" BorderThickness="2" CornerRadius="16" Margin="-2"
                                                                        IsVisible="{Binding $parent[Window].((vm:MainWindowViewModel)DataContext).BorderColor, Converter={StaticResource ColorMatchConverter}, ConverterParameter={Binding}}"/>
                                                                <Border CornerRadius="16" BoxShadow="inset 0 0 5 0 #80000000"/>
                                                            </Panel>
                                                        </Button>
                                                    </DataTemplate>
                                                </ItemsControl.ItemTemplate>
                                            </ItemsControl>
                                        </StackPanel>
                                    </StackPanel>

                                    <!-- Style Preview Area -->
                                    <StackPanel Grid.Column="1" Spacing="10" VerticalAlignment="Top" Margin="20,0,0,0">
                                        <TextBlock Text="{Binding [StylePreview], Source={x:Static services:LocalizationService.Instance}}" FontWeight="SemiBold" HorizontalAlignment="Center"/>
                                        <Border Background="#1A1A1A" Width="550" Height="250" CornerRadius="4" BorderBrush="#333333" BorderThickness="1" ClipToBounds="True">
                                            <Grid>
                                                <!-- Mock Background -->
                                                <Image Source="avares://GimmeCapture/Assets/kitsune_icon.png" Opacity="0.1" Stretch="Uniform" Margin="20"/>
                                                
                                                <!-- Selection Preview Mask (Excludes Center Area) -->
                                                <Path Fill="Black" Opacity="{Binding MaskOpacity}" IsHitTestVisible="False">
                                                    <Path.Data>
                                                        <CombinedGeometry GeometryCombineMode="Exclude">
                                                            <CombinedGeometry.Geometry1>
                                                                <RectangleGeometry Rect="0,0,550,250" />
                                                            </CombinedGeometry.Geometry1>
                                                            <CombinedGeometry.Geometry2>
                                                                <RectangleGeometry Rect="175,65,200,120" />
                                                            </CombinedGeometry.Geometry2>
                                                        </CombinedGeometry>
                                                    </Path.Data>
                                                </Path>
                                                
                                                <!-- Selection Preview -->
                                                <Grid Margin="15" VerticalAlignment="Center" HorizontalAlignment="Center" ClipToBounds="False">
                                                    <Border CornerRadius="0"
                                                            Background="#01FFFFFF"
                                                            BoxShadow="{Binding BorderColor, Converter={StaticResource ColorToBoxShadowConverter}}">
                                                        <Border.BorderBrush>
                                                            <LinearGradientBrush StartPoint="0%,0%" EndPoint="100%,100%">
                                                                <GradientStop Offset="0" Color="{Binding BorderColor}"/>
                                                                <GradientStop Offset="0.5" Color="{Binding BorderColor}"/>
                                                                <GradientStop Offset="1" Color="{Binding BorderColor}"/>
                                                            </LinearGradientBrush>
                                                        </Border.BorderBrush>
                                                        <Border BorderBrush="{Binding BorderColor, Converter={StaticResource ColorToBrushConverter}}" 
                                                                BorderThickness="{Binding BorderThickness, Converter={StaticResource ThicknessConverter}}">
                                                            <Border BorderBrush="{Binding BorderColor, Converter={StaticResource ColorToBrushConverter}}" BorderThickness="1" Margin="-1">
                                                                <Grid Width="200" Height="120" ClipToBounds="False">
                                                                    <!-- Wings -->
                                                                    <Rectangle Width="{Binding PreviewWingWidth}" Height="{Binding PreviewWingHeight}" VerticalAlignment="Center"
                                                                               HorizontalAlignment="Left" Margin="{Binding PreviewLeftWingMargin}"
                                                                               Fill="{Binding BorderColor, Converter={StaticResource ColorToBrushConverter}}">
                                                                        <Rectangle.OpacityMask>
                                                                            <ImageBrush Source="/Assets/wing_left.png" Stretch="Uniform" AlignmentX="Right"/>
                                                                        </Rectangle.OpacityMask>
                                                                    </Rectangle>
                                                                    <Rectangle Width="{Binding PreviewWingWidth}" Height="{Binding PreviewWingHeight}" VerticalAlignment="Center"
                                                                               HorizontalAlignment="Right" Margin="{Binding PreviewRightWingMargin}"
                                                                               Fill="{Binding BorderColor, Converter={StaticResource ColorToBrushConverter}}">
                                                                        <Rectangle.OpacityMask>
                                                                            <ImageBrush Source="/Assets/wing_right.png" Stretch="Uniform" AlignmentX="Left"/>
                                                                        </Rectangle.OpacityMask>
                                                                    </Rectangle>

                                                                    <!-- Accent Corners: Hearts & Skulls -->
                                                                    <Rectangle Width="{Binding PreviewIconSize}" Height="{Binding PreviewIconSize}" VerticalAlignment="Top" HorizontalAlignment="Left" Margin="4"
                                                                               Fill="{Binding BorderColor, Converter={StaticResource ColorToBrushConverter}}">
                                                                        <Rectangle.OpacityMask>
                                                                            <ImageBrush Source="/Assets/heart.png" Stretch="Uniform"/>
                                                                        </Rectangle.OpacityMask>
                                                                    </Rectangle>
                                                                    <Rectangle Width="{Binding PreviewIconSize}" Height="{Binding PreviewIconSize}" VerticalAlignment="Bottom" HorizontalAlignment="Left" Margin="4"
                                                                               Fill="{Binding BorderColor, Converter={StaticResource ColorToBrushConverter}}">
                                                                        <Rectangle.OpacityMask>
                                                                            <ImageBrush Source="/Assets/heart.png" Stretch="Uniform" />
                                                                        </Rectangle.OpacityMask>
                                                                    </Rectangle>
                                                                    <Rectangle Width="{Binding PreviewIconSize}" Height="{Binding PreviewIconSize}" VerticalAlignment="Top" HorizontalAlignment="Right" Margin="4"
                                                                               Fill="{Binding BorderColor, Converter={StaticResource ColorToBrushConverter}}">
                                                                        <Rectangle.OpacityMask>
                                                                            <ImageBrush Source="/Assets/skull.png" Stretch="Uniform" />
                                                                        </Rectangle.OpacityMask>
                                                                    </Rectangle>
                                                                    <Rectangle Width="{Binding PreviewIconSize}" Height="{Binding PreviewIconSize}" VerticalAlignment="Bottom" HorizontalAlignment="Right" Margin="4"
                                                                               Fill="{Binding BorderColor, Converter={StaticResource ColorToBrushConverter}}">
                                                                        <Rectangle.OpacityMask>
                                                                            <ImageBrush Source="/Assets/skull.png" Stretch="Uniform" />
                                                                        </Rectangle.OpacityMask>
                                                                    </Rectangle>
                                                                </Grid>
                                                            </Border>
                                                        </Border>
                                                    </Border>
                                                </Grid>
                                            </Grid>
                                        </Border>
                                    </StackPanel>
                                </Grid>
                            </StackPanel>
                        </StackPanel>
                    </Grid>
                </ScrollViewer>
            </TabItem>
            
            <!-- 擷圖 (Snip) -->
            <TabItem Header="{Binding [TabSnip], Source={x:Static services:LocalizationService.Instance}}">
                <ScrollViewer>
                    <Grid ColumnDefinitions="*, Auto" Margin="10">
                        <!-- Settings Controls -->
                        <StackPanel Grid.Column="0" Spacing="15" Margin="0,0,20,0">
                            <!-- Output Settings Back in Snip Tab -->
                            <StackPanel Spacing="10">
                                <TextBlock Text="{Binding [TabOutput], Source={x:Static services:LocalizationService.Instance}}" FontWeight="SemiBold"/>
                                <StackPanel Spacing="5">
                                    <CheckBox IsChecked="{Binding AutoSave}" Content="{Binding [AutoSave], Source={x:Static services:LocalizationService.Instance}}"/>
                                    <DockPanel Margin="24,0,0,5">
                                        <Button Content="{Binding [SelectPath], Source={x:Static services:LocalizationService.Instance}}" 
                                                DockPanel.Dock="Right" 
                                                Theme="{StaticResource SmallGothicMetalButton}"
                                                Command="{Binding SelectSavePath}" 
                                                Margin="10,0,0,0"/>
                                        <TextBox Text="{Binding SaveDirectory}" Margin="0,0,10,0"/>
                                    </DockPanel>
                                    <CheckBox IsChecked="{Binding HideSnipPinDecoration}" Content="{Binding [HideSnipPinDecoration], Source={x:Static services:LocalizationService.Instance}}"/>
                                    <CheckBox IsChecked="{Binding HideSnipPinBorder}" Content="{Binding [HideSnipPinBorder], Source={x:Static services:LocalizationService.Instance}}"/>
                                    <CheckBox IsChecked="{Binding HideSnipSelectionDecoration}" Content="{Binding [HideSnipSelectionDecoration], Source={x:Static services:LocalizationService.Instance}}"/>
                                    <CheckBox IsChecked="{Binding HideSnipSelectionBorder}" Content="{Binding [HideSnipSelectionBorder], Source={x:Static services:LocalizationService.Instance}}"/>
                                    <CheckBox IsChecked="{Binding ShowSnipCursor}" Content="{Binding [ShowSnipCursor], Source={x:Static services:LocalizationService.Instance}}"/>
                                </StackPanel>
                            </StackPanel>
                        </StackPanel>
                    </Grid>
                </ScrollViewer>
            </TabItem>

            <!-- Recording Tab -->
            <TabItem Header="{Binding [TabRecord], Source={x:Static services:LocalizationService.Instance}}">
                <ScrollViewer>
                    <StackPanel Spacing="15" Margin="10">
                        <StackPanel Spacing="10">
                            <TextBlock Text="{Binding [TabOutput], Source={x:Static services:LocalizationService.Instance}}" FontWeight="SemiBold"/>
                            <StackPanel Spacing="5">
                                <CheckBox IsChecked="{Binding UseFixedRecordPath}" Content="{Binding [UseFixedRecordPath], Source={x:Static services:LocalizationService.Instance}}"/>
                                <DockPanel Margin="24,0,0,5">
                                    <Button Content="{Binding [SelectPath], Source={x:Static services:LocalizationService.Instance}}" 
                                            DockPanel.Dock="Right" 
                                            Theme="{StaticResource SmallGothicMetalButton}"
                                            Command="{Binding SelectVideoPath}" 
                                            Margin="10,0,0,0"/>
                                    <TextBox Text="{Binding VideoSaveDirectory}" Margin="0,0,10,0"/>
                                </DockPanel>

                                <TextBlock Text="{Binding [TempPath], Source={x:Static services:LocalizationService.Instance}}" VerticalAlignment="Center" Margin="0,10,0,0"/>
                                <DockPanel Margin="24,0,0,5">
                                    <Button Content="{Binding [SelectPath], Source={x:Static services:LocalizationService.Instance}}" 
                                            DockPanel.Dock="Right" 
                                            Theme="{StaticResource SmallGothicMetalButton}"
                                            Command="{Binding SelectTempPath}" 
                                            Margin="10,0,0,0"/>
                                    <TextBox Text="{Binding TempDirectory}" Margin="0,0,10,0" Watermark="{Binding [TempDirectoryWatermark], Source={x:Static services:LocalizationService.Instance}}"/>
                                </DockPanel>

                                <DockPanel Margin="0,10,0,0">
                                    <TextBlock Text="{Binding [VideoFormat], Source={x:Static services:LocalizationService.Instance}}" VerticalAlignment="Center" Margin="0,0,10,0"/>
                                    <ComboBox ItemsSource="{Binding AvailableRecordFormats}" SelectedItem="{Binding RecordFormat}" HorizontalAlignment="Stretch"/>
                                </DockPanel>

                                <DockPanel Margin="0,10,0,10">
                                    <TextBlock Text="{Binding [VideoCodec], Source={x:Static services:LocalizationService.Instance}}" VerticalAlignment="Center" Margin="0,0,10,0"/>
                                    <ComboBox ItemsSource="{Binding VideoCodecOptions}" SelectedItem="{Binding SelectedVideoCodecOption}" HorizontalAlignment="Stretch">
                                        <ComboBox.ItemTemplate>
                                            <DataTemplate x:DataType="vm:MainWindowViewModel+VideoCodecOption">
                                                <TextBlock Text="{Binding Name}"/>
                                            </DataTemplate>
                                        </ComboBox.ItemTemplate>
                                    </ComboBox>
                                </DockPanel>


                                <CheckBox Content="{Binding [HideRecordPinDecoration], Source={x:Static services:LocalizationService.Instance}}" IsChecked="{Binding HideRecordPinDecoration}" Margin="0,5,0,0"/>
                                <CheckBox Content="{Binding [HideRecordPinBorder], Source={x:Static services:LocalizationService.Instance}}" IsChecked="{Binding HideRecordPinBorder}" Margin="0,5,0,0"/>
                                <CheckBox Content="{Binding [HideRecordSelectionDecoration], Source={x:Static services:LocalizationService.Instance}}" IsChecked="{Binding HideRecordSelectionDecoration}" Margin="0,5,0,0"/>
                                <CheckBox Content="{Binding [HideRecordSelectionBorder], Source={x:Static services:LocalizationService.Instance}}" IsChecked="{Binding HideRecordSelectionBorder}" Margin="0,5,0,0"/>
                                    <StackPanel Spacing="5" Margin="0,5,0,0">
                                        <TextBlock Text="{Binding [RecordFPS], Source={x:Static services:LocalizationService.Instance}}" FontSize="12"/>
                                        <StackPanel Orientation="Horizontal" Spacing="10">
                                            <Slider Minimum="5" Maximum="60" Value="{Binding RecordFPS}" 
                                                    TickFrequency="5" IsSnapToTickEnabled="True" HorizontalAlignment="Stretch" Width="250"/>
                                            <c:CompactNumericStep Value="{Binding RecordFPS}"
                                                                   IncreaseCommand="{Binding IncreaseRecordFPSCommand}"
                                                                   DecreaseCommand="{Binding DecreaseRecordFPSCommand}"/>
                                        </StackPanel>
                                    </StackPanel>

                                    <CheckBox Content="{Binding [ShowRecordCursor], Source={x:Static services:LocalizationService.Instance}}" 
 IsChecked="{Binding ShowRecordCursor}" Margin="0,5,0,0"/>
                            </StackPanel>
                        </StackPanel>
                    </StackPanel>
                </ScrollViewer>
            </TabItem>

            <!-- 翻譯設定 (Translation) -->
            <TabItem Header="{Binding [TabTranslation], Source={x:Static services:LocalizationService.Instance}}">
                <ScrollViewer>
                    <Grid ColumnDefinitions="*, Auto" Margin="10">
                        <StackPanel Grid.Column="0" Spacing="15" Margin="0,0,20,0">
                            <!-- Translation & Engine Group -->
                            <Border Background="#1A1A1A" Padding="15" CornerRadius="4" BorderBrush="#333333" BorderThickness="1" Margin="10,10,0,10">
                                <StackPanel Spacing="10">
                                    <TextBlock Text="{Binding [TranslationSettings], Source={x:Static services:LocalizationService.Instance}}" FontWeight="SemiBold" Foreground="{DynamicResource AccentRedBrush}"/>
                                    
                                    <!-- Engine First -->
                                    <DockPanel>
                                        <TextBlock Text="{Binding [TranslationEngine], Source={x:Static services:LocalizationService.Instance}}" VerticalAlignment="Center" Margin="0,0,10,0"/>
                                        <ComboBox ItemsSource="{Binding AvailableTranslationEngines}" SelectedItem="{Binding SelectedTranslationEngine, Mode=TwoWay}" HorizontalAlignment="Stretch">
                                            <ComboBox.ItemTemplate>
                                                <DataTemplate>
                                                    <TextBlock Text="{Binding Converter={x:Static converters:EnumToLocalizedConverter.Instance}, ConverterParameter='TranslationEngine'}"/>
                                                </DataTemplate>
                                            </ComboBox.ItemTemplate>
                                        </ComboBox>
                                    </DockPanel>

                                    <!-- OCR Source Language -->
                                    <DockPanel>
                                        <TextBlock Text="{Binding [OCRLanguage], Source={x:Static services:LocalizationService.Instance}}" VerticalAlignment="Center" Margin="0,0,10,0"/>
                                        <ComboBox ItemsSource="{Binding AvailableOCRLanguages}" SelectedItem="{Binding SourceLanguage}" HorizontalAlignment="Stretch">
                                            <ComboBox.ItemTemplate>
                                                <DataTemplate>
                                                    <TextBlock Text="{Binding Converter={x:Static converters:EnumToLocalizedConverter.Instance}, ConverterParameter='OCRLang'}"/>
                                                </DataTemplate>
                                            </ComboBox.ItemTemplate>
                                        </ComboBox>
                                    </DockPanel>

                                    <!-- Target Language -->
                                    <DockPanel>
                                        <TextBlock Text="{Binding [TranslationLanguage], Source={x:Static services:LocalizationService.Instance}}" VerticalAlignment="Center" Margin="0,0,10,0"/>
                                        <ComboBox ItemsSource="{Binding AvailableTranslationLanguages}" SelectedItem="{Binding TargetLanguage}" HorizontalAlignment="Stretch">
                                            <ComboBox.ItemTemplate>
                                                <DataTemplate>
                                                    <TextBlock Text="{Binding Converter={x:Static converters:EnumToLocalizedConverter.Instance}, ConverterParameter='Lang'}"/>
                                                </DataTemplate>
                                            </ComboBox.ItemTemplate>
                                        </ComboBox>
                                    </DockPanel>

                                    <!-- Ollama Specific Settings -->
                                    <StackPanel IsVisible="{Binding IsOllamaVisible}" Spacing="10" Margin="0,5,0,0">
                                        <Separator Background="#333333" Height="1" Margin="0,5"/>
                                        <TextBlock Text="Ollama" FontWeight="SemiBold" Foreground="{DynamicResource AccentRedBrush}"/>
                                        <StackPanel Spacing="5">
                                            <TextBlock Text="{Binding [OllamaModel], Source={x:Static services:LocalizationService.Instance}}" FontSize="12"/>
                                            <Grid ColumnDefinitions="*, Auto">
                                                <ComboBox Grid.Column="0" 
                                                          ItemsSource="{Binding AvailableOllamaModels}" 
                                                          Text="{Binding OllamaModel}"
                                                          IsEditable="True"
                                                          HorizontalAlignment="Stretch"
                                                          Margin="0,0,10,0"/>
                                                <Button Grid.Column="1" 
                                                        Content="↻" 
                                                        Command="{Binding RefreshOllamaModelsCommand}"
                                                        ToolTip.Tip="Refresh Models"
                                                        Theme="{StaticResource SmallGothicMetalButton}"/>
                                            </Grid>
                                            
                                            <TextBlock Text="{Binding [OllamaApiUrl], Source={x:Static services:LocalizationService.Instance}}" FontSize="12" Margin="0,5,0,0"/>
                                            <TextBox Text="{Binding OllamaApiUrl}" Watermark="http://localhost:11434/api/generate"/>
                                        </StackPanel>
                                    </StackPanel>
                                </StackPanel>
                            </Border>
                        </StackPanel>
                    </Grid>
                </ScrollViewer>
            </TabItem>

            <!-- AI Settings (AI) -->
            <TabItem Header="{Binding [TabAI], Source={x:Static services:LocalizationService.Instance}}">
                <ScrollViewer>
                    <Grid ColumnDefinitions="*, Auto" Margin="10">
                        <StackPanel Grid.Column="0" Spacing="15" Margin="0,0,20,0">
                            <StackPanel Spacing="10">
                                <CheckBox IsChecked="{Binding EnableAI}" Content="{Binding [EnableAI], Source={x:Static services:LocalizationService.Instance}}" FontWeight="SemiBold"/>
                                
                                <StackPanel Spacing="5" IsEnabled="{Binding EnableAI}">
                                    <!-- Detection & Scanning Group (First in AI Tab now) -->
                                    <Border Background="#1A1A1A" Padding="15" CornerRadius="4" BorderBrush="#333333" BorderThickness="1" Margin="24,10,0,10">
                                        <StackPanel Spacing="10">
                                            <TextBlock Text="{Binding [DetectionSettings], Source={x:Static services:LocalizationService.Instance}}" FontWeight="SemiBold" Foreground="{DynamicResource AccentRedBrush}"/>
                                            
                                            <StackPanel Spacing="5">
                                                <CheckBox IsChecked="{Binding ShowAIScanBox}" Content="{Binding [ShowAIScanBox], Source={x:Static services:LocalizationService.Instance}}"/>
                                                <CheckBox IsChecked="{Binding EnableAIScan}" Content="{Binding [EnableAIScan], Source={x:Static services:LocalizationService.Instance}}"/>
                                            </StackPanel>
                                            <Separator Background="#333333" Height="1" Margin="0,5"/>
                                            <StackPanel Spacing="5">
                                                <TextBlock Text="{Binding [AIScanDensity], Source={x:Static services:LocalizationService.Instance}}" FontSize="12"/>
                                                <StackPanel Orientation="Horizontal" Spacing="10">
                                                    <Slider Minimum="4" Maximum="32" Value="{Binding SAM2GridDensity}" 
                                                            TickFrequency="1" IsSnapToTickEnabled="True" HorizontalAlignment="Stretch" Width="250"/>
                                                    <TextBlock Text="{Binding SAM2GridDensity}" VerticalAlignment="Center" Width="30"/>
                                                </StackPanel>
                                            </StackPanel>
                                            <StackPanel Spacing="5">
                                                <TextBlock Text="{Binding [AIScanMaxObjects], Source={x:Static services:LocalizationService.Instance}}" FontSize="12"/>
                                                <StackPanel Orientation="Horizontal" Spacing="10">
                                                    <Slider Minimum="5" Maximum="200" Value="{Binding SAM2MaxObjects}" 
                                                            TickFrequency="5" IsSnapToTickEnabled="True" HorizontalAlignment="Stretch" Width="250"/>
                                                    <TextBlock Text="{Binding SAM2MaxObjects}" VerticalAlignment="Center" Width="30"/>
                                                </StackPanel>
                                            </StackPanel>
                                            <StackPanel Spacing="5">
                                                <TextBlock Text="{Binding [AIScanMinSize], Source={x:Static services:LocalizationService.Instance}}" FontSize="12"/>
                                                <StackPanel Orientation="Horizontal" Spacing="10">
                                                    <Slider Minimum="5" Maximum="200" Value="{Binding SAM2MinObjectSize}" 
                                                            TickFrequency="5" IsSnapToTickEnabled="True" HorizontalAlignment="Stretch" Width="250"/>
                                                    <TextBlock Text="{Binding SAM2MinObjectSize}" VerticalAlignment="Center" Width="30"/>
                                                </StackPanel>
                                            </StackPanel>
                                        </StackPanel>
                                    </Border>
                                    
                                    <!-- Resource Path -->
                                    <TextBlock Text="{Binding [AIResourcesPath], Source={x:Static services:LocalizationService.Instance}}" FontSize="12" Foreground="#888888" Margin="24,10,0,0"/>
                                    <DockPanel Margin="24,0,0,10">
                                        <Button Content="{Binding [SelectPath], Source={x:Static services:LocalizationService.Instance}}" 
                                                DockPanel.Dock="Right" 
                                                Theme="{StaticResource SmallGothicMetalButton}"
                                                Command="{Binding PickAIFolderCommand}" 
                                                Margin="10,0,0,0"/>
                                        <TextBox Text="{Binding AIResourcesDirectory}" Margin="0,0,10,0"/>
                                    </DockPanel>
                                </StackPanel>
                            </StackPanel>
                        </StackPanel>
                    </Grid>
                </ScrollViewer>
            </TabItem>
            
            <!-- 控制 (Control/Hotkeys) -->
            <TabItem Header="{Binding [TabControl], Source={x:Static services:LocalizationService.Instance}}">
                <ScrollViewer>
                    <StackPanel Spacing="10" Margin="10">
                        <TextBlock Text="{Binding [GlobalHotkeys], Source={x:Static services:LocalizationService.Instance}}" FontWeight="Bold" Margin="0,0,0,10"/>
                        
                        <!-- 1. Startup Hotkeys -->
                        <Border Background="#1A1A1A" Padding="15" CornerRadius="4" BorderBrush="#333333" BorderThickness="1" Margin="0,0,0,10">
                            <StackPanel Spacing="10">
                                <TextBlock Text="{Binding [HotkeyStartupGroup], Source={x:Static services:LocalizationService.Instance}}" FontWeight="SemiBold" Foreground="{Binding ThemeColor, Converter={StaticResource ColorToBrushConverter}}"/>
                                <Grid ColumnDefinitions="Auto, 10, *" RowDefinitions="Auto, Auto">
                                    <TextBlock Grid.Row="0" Grid.Column="0" Text="{Binding [SnipHotkey], Source={x:Static services:LocalizationService.Instance}}" VerticalAlignment="Center"/>
                                    <TextBox Grid.Row="0" Grid.Column="2" 
                                             Text="{Binding SnipHotkey, Mode=OneWay}" 
                                             Watermark="{Binding [HotkeyWatermark], Source={x:Static services:LocalizationService.Instance}}"
                                             IsReadOnly="True"
                                             Name="SnipHotkeyBox"
                                             KeyDown="HotkeyTextBox_KeyDown"/>

                                    <TextBlock Grid.Row="1" Grid.Column="0" Text="{Binding [RecordHotkey], Source={x:Static services:LocalizationService.Instance}}" VerticalAlignment="Center" Margin="0,10,0,0"/>
                                    <TextBox Grid.Row="1" Grid.Column="2" 
                                             Text="{Binding RecordHotkey, Mode=OneWay}" 
                                             Watermark="{Binding [HotkeyWatermark], Source={x:Static services:LocalizationService.Instance}}"
                                             IsReadOnly="True"
                                             Name="RecordHotkeyBox"
                                             Margin="0,10,0,0"
                                             KeyDown="HotkeyTextBox_KeyDown"/>
                                </Grid>
                            </StackPanel>
                        </Border>

                        <!-- 2. Drawing Tool Hotkeys -->
                        <Border Background="#1A1A1A" Padding="15" CornerRadius="4" BorderBrush="#333333" BorderThickness="1" Margin="0,0,0,10">
                            <StackPanel Spacing="10">
                                <TextBlock Text="{Binding [HotkeyDrawingGroup], Source={x:Static services:LocalizationService.Instance}}" FontWeight="SemiBold" Foreground="{Binding ThemeColor, Converter={StaticResource ColorToBrushConverter}}"/>
                                <UniformGrid Columns="2">
                                    <Grid ColumnDefinitions="Auto, 10, *" RowDefinitions="Auto, Auto, Auto, Auto" Margin="0,0,10,0">
                                        <TextBlock Grid.Row="0" Grid.Column="0" Text="{Binding [TipRectangle], Source={x:Static services:LocalizationService.Instance}}" VerticalAlignment="Center"/>
                                        <TextBox Grid.Row="0" Grid.Column="2" Text="{Binding RectangleHotkey, Mode=OneWay}" IsReadOnly="True" Name="RectHotkeyBox" KeyDown="HotkeyTextBox_KeyDown"/>
                                        
                                        <TextBlock Grid.Row="1" Grid.Column="0" Text="{Binding [TipEllipse], Source={x:Static services:LocalizationService.Instance}}" VerticalAlignment="Center" Margin="0,10,0,0"/>
                                        <TextBox Grid.Row="1" Grid.Column="2" Text="{Binding EllipseHotkey, Mode=OneWay}" IsReadOnly="True" Name="EllipseHotkeyBox" Margin="0,10,0,0" KeyDown="HotkeyTextBox_KeyDown"/>

                                        <TextBlock Grid.Row="2" Grid.Column="0" Text="{Binding [TipArrow], Source={x:Static services:LocalizationService.Instance}}" VerticalAlignment="Center" Margin="0,10,0,0"/>
                                        <TextBox Grid.Row="2" Grid.Column="2" Text="{Binding ArrowHotkey, Mode=OneWay}" IsReadOnly="True" Name="ArrowHotkeyBox" Margin="0,10,0,0" KeyDown="HotkeyTextBox_KeyDown"/>

                                        <TextBlock Grid.Row="3" Grid.Column="0" Text="{Binding [TipLine], Source={x:Static services:LocalizationService.Instance}}" VerticalAlignment="Center" Margin="0,10,0,0"/>
                                        <TextBox Grid.Row="3" Grid.Column="2" Text="{Binding LineHotkey, Mode=OneWay}" IsReadOnly="True" Name="LineHotkeyBox" Margin="0,10,0,0" KeyDown="HotkeyTextBox_KeyDown"/>
                                    </Grid>
                                    <Grid ColumnDefinitions="Auto, 10, *" RowDefinitions="Auto, Auto, Auto, Auto">
                                        <TextBlock Grid.Row="0" Grid.Column="0" Text="{Binding [TipPen], Source={x:Static services:LocalizationService.Instance}}" VerticalAlignment="Center"/>
                                        <TextBox Grid.Row="0" Grid.Column="2" Text="{Binding PenHotkey, Mode=OneWay}" IsReadOnly="True" Name="PenHotkeyBox" KeyDown="HotkeyTextBox_KeyDown"/>

                                        <TextBlock Grid.Row="1" Grid.Column="0" Text="{Binding [TipText], Source={x:Static services:LocalizationService.Instance}}" VerticalAlignment="Center" Margin="0,10,0,0"/>
                                        <TextBox Grid.Row="1" Grid.Column="2" Text="{Binding TextHotkey, Mode=OneWay}" IsReadOnly="True" Name="TextHotkeyBox" Margin="0,10,0,0" KeyDown="HotkeyTextBox_KeyDown"/>

                                        <TextBlock Grid.Row="2" Grid.Column="0" Text="{Binding [TipMosaic], Source={x:Static services:LocalizationService.Instance}}" VerticalAlignment="Center" Margin="0,10,0,0"/>
                                        <TextBox Grid.Row="2" Grid.Column="2" Text="{Binding MosaicHotkey, Mode=OneWay}" IsReadOnly="True" Name="MosaicHotkeyBox" Margin="0,10,0,0" KeyDown="HotkeyTextBox_KeyDown"/>

                                        <TextBlock Grid.Row="3" Grid.Column="0" Text="{Binding [TipBlur], Source={x:Static services:LocalizationService.Instance}}" VerticalAlignment="Center" Margin="0,10,0,0"/>
                                        <TextBox Grid.Row="3" Grid.Column="2" Text="{Binding BlurHotkey, Mode=OneWay}" IsReadOnly="True" Name="BlurHotkeyBox" Margin="0,10,0,0" KeyDown="HotkeyTextBox_KeyDown"/>
                                    </Grid>
                                </UniformGrid>
                            </StackPanel>
                        </Border>

                        <!-- 3. Common Action Hotkeys -->
                        <Border Background="#1A1A1A" Padding="15" CornerRadius="4" BorderBrush="#333333" BorderThickness="1" Margin="0,0,0,10">
                            <StackPanel Spacing="10">
                                <TextBlock Text="{Binding [HotkeyCommonGroup], Source={x:Static services:LocalizationService.Instance}}" FontWeight="SemiBold" Foreground="{Binding ThemeColor, Converter={StaticResource ColorToBrushConverter}}"/>
                                <UniformGrid Columns="2">
                                    <Grid ColumnDefinitions="Auto, 10, *" RowDefinitions="Auto, Auto, Auto, Auto, Auto" Margin="0,0,10,0">
                                        <TextBlock Grid.Row="0" Grid.Column="0" Text="{Binding [Undo], Source={x:Static services:LocalizationService.Instance}}" VerticalAlignment="Center"/>
                                        <TextBox Grid.Row="0" Grid.Column="2" Text="{Binding UndoHotkey, Mode=OneWay}" IsReadOnly="True" Name="UndoHotkeyBox" KeyDown="HotkeyTextBox_KeyDown"/>

                                        <TextBlock Grid.Row="1" Grid.Column="0" Text="{Binding [Redo], Source={x:Static services:LocalizationService.Instance}}" VerticalAlignment="Center" Margin="0,10,0,0"/>
                                        <TextBox Grid.Row="1" Grid.Column="2" Text="{Binding RedoHotkey, Mode=OneWay}" IsReadOnly="True" Name="RedoHotkeyBox" Margin="0,10,0,0" KeyDown="HotkeyTextBox_KeyDown"/>

                                        <TextBlock Grid.Row="2" Grid.Column="0" Text="{Binding [Clear], Source={x:Static services:LocalizationService.Instance}}" VerticalAlignment="Center" Margin="0,10,0,0"/>
                                        <TextBox Grid.Row="2" Grid.Column="2" Text="{Binding ClearHotkey, Mode=OneWay}" IsReadOnly="True" Name="ClearHotkeyBox" Margin="0,10,0,0" KeyDown="HotkeyTextBox_KeyDown"/>

                                        <TextBlock Grid.Row="3" Grid.Column="0" Text="{Binding [TipSave], Source={x:Static services:LocalizationService.Instance}}" VerticalAlignment="Center" Margin="0,10,0,0"/>
                                        <TextBox Grid.Row="3" Grid.Column="2" Text="{Binding SaveHotkey, Mode=OneWay}" IsReadOnly="True" Name="SaveHotkeyBox" Margin="0,10,0,0" KeyDown="HotkeyTextBox_KeyDown"/>

                                        <TextBlock Grid.Row="4" Grid.Column="0" Text="{Binding [TipCopy], Source={x:Static services:LocalizationService.Instance}}" VerticalAlignment="Center" Margin="0,10,0,0"/>
                                        <TextBox Grid.Row="4" Grid.Column="2" Text="{Binding CopyHotkey, Mode=OneWay}" IsReadOnly="True" Name="CopyHotkeyBox_Generic" Margin="0,10,0,0" KeyDown="HotkeyTextBox_KeyDown"/>
                                    </Grid>
                                    <Grid ColumnDefinitions="Auto, 10, *" RowDefinitions="Auto, Auto, Auto, Auto, Auto">
                                        <TextBlock Grid.Row="0" Grid.Column="0" Text="{Binding [ActionClose], Source={x:Static services:LocalizationService.Instance}}" VerticalAlignment="Center"/>
                                        <TextBox Grid.Row="0" Grid.Column="2" Text="{Binding CloseHotkey, Mode=OneWay}" IsReadOnly="True" Name="CloseHotkeyBox" KeyDown="HotkeyTextBox_KeyDown"/>

                                        <TextBlock Grid.Row="1" Grid.Column="0" Text="{Binding [ActionPlayback], Source={x:Static services:LocalizationService.Instance}}" VerticalAlignment="Center" Margin="0,10,0,0"/>
                                        <TextBox Grid.Row="1" Grid.Column="2" Text="{Binding TogglePlaybackHotkey, Mode=OneWay}" IsReadOnly="True" Name="PlaybackHotkeyBox" Margin="0,10,0,0" KeyDown="HotkeyTextBox_KeyDown"/>

                                        <TextBlock Grid.Row="2" Grid.Column="0" Text="{Binding [ActionToolbar], Source={x:Static services:LocalizationService.Instance}}" VerticalAlignment="Center" Margin="0,10,0,0"/>
                                        <TextBox Grid.Row="2" Grid.Column="2" Text="{Binding ToggleToolbarHotkey, Mode=OneWay}" IsReadOnly="True" Name="ToolbarHotkeyBox" Margin="0,10,0,0" KeyDown="HotkeyTextBox_KeyDown"/>

                                        <TextBlock Grid.Row="3" Grid.Column="0" Text="{Binding [ActionSelectionMode], Source={x:Static services:LocalizationService.Instance}}" VerticalAlignment="Center" Margin="0,10,0,0"/>
                                        <TextBox Grid.Row="3" Grid.Column="2" Text="{Binding SelectionModeHotkey, Mode=OneWay}" IsReadOnly="True" Name="SelectionModeHotkeyBox" Margin="0,10,0,0" KeyDown="HotkeyTextBox_KeyDown"/>

                                        <TextBlock Grid.Row="4" Grid.Column="0" Text="{Binding [ActionCropMode], Source={x:Static services:LocalizationService.Instance}}" VerticalAlignment="Center" Margin="0,10,0,0"/>
                                        <TextBox Grid.Row="4" Grid.Column="2" Text="{Binding CropModeHotkey, Mode=OneWay}" IsReadOnly="True" Name="CropModeHotkeyBox" Margin="0,10,0,0" KeyDown="HotkeyTextBox_KeyDown"/>
                                    </Grid>
                                </UniformGrid>
                            </StackPanel>
                        </Border>

                        <!-- Original Mode Specific (Keeping for backward compatibility/clarity if needed, but the generic ones above covers a lot) -->
                        <Grid ColumnDefinitions="*, 10, *">
                            <!-- Global Actions -->
                            <Border Grid.Column="0" Background="#1A1A1A" Padding="15" CornerRadius="4" BorderBrush="#333333" BorderThickness="1">
                                <StackPanel Spacing="10">
                                    <TextBlock Text="{Binding [ActionPin], Source={x:Static services:LocalizationService.Instance}}" FontWeight="SemiBold" Foreground="{Binding ThemeColor, Converter={StaticResource ColorToBrushConverter}}"/>
                                    <Grid ColumnDefinitions="Auto, 10, *" RowDefinitions="Auto">
                                        <TextBlock Grid.Row="0" Grid.Column="0" Text="{Binding [PinHotkey], Source={x:Static services:LocalizationService.Instance}}" VerticalAlignment="Center"/>
                                        <TextBox Grid.Row="0" Grid.Column="2" 
                                                 Text="{Binding PinHotkey, Mode=OneWay}" 
                                                 IsReadOnly="True"
                                                 Name="PinHotkeyBox_Snip" 
                                                 KeyDown="HotkeyTextBox_KeyDown"/>
                                    </Grid>
                                </StackPanel>
                            </Border>
                        </Grid>
                        
                        <TextBlock Text="{Binding [HotkeysActive], Source={x:Static services:LocalizationService.Instance}}" Foreground="{Binding ThemeColor, Converter={StaticResource ColorToBrushConverter}}" FontStyle="Italic" FontSize="11"/>
                    </StackPanel>
                </ScrollViewer>
            </TabItem>
            
            <!-- 模組管理 (Modules) -->
            <TabItem Header="{Binding [TabModules], Source={x:Static services:LocalizationService.Instance}}">
                <ScrollViewer>
                    <ItemsControl ItemsSource="{Binding Modules}" Margin="10">
                        <ItemsControl.ItemTemplate>
                            <DataTemplate>
                                <Border Background="#1A1A1A" BorderBrush="#333333" BorderThickness="1" CornerRadius="4" Margin="0,0,0,10" Padding="15">
                                    <Grid ColumnDefinitions="*, Auto">
                                        <StackPanel Grid.Column="0" Spacing="5">
                                            <StackPanel Orientation="Horizontal" Spacing="10">
                                                <TextBlock Text="{Binding Name}" FontSize="16" FontWeight="Bold" Foreground="{DynamicResource AccentRedBrush}"/>
                                                <Border Background="{Binding IsInstalled, Converter={StaticResource StatusToColorConverter}}" CornerRadius="10" Padding="8,2" VerticalAlignment="Center">
                                                    <TextBlock Text="{Binding StatusText}" FontSize="10" Foreground="White" FontWeight="Bold"/>
                                                </Border>
                                            </StackPanel>
                                            <TextBlock Text="{Binding Description}" TextWrapping="Wrap" Opacity="0.7" FontSize="12"/>
                                            
                                            <!-- Progress Section -->
                                            <StackPanel IsVisible="{Binding IsProcessing}" Spacing="5" Margin="0,5,0,0">
                                                <ProgressBar Value="{Binding Progress}" Height="4" Foreground="{DynamicResource AccentRedBrush}" Minimum="0" Maximum="100"/>
                                                <TextBlock Text="{Binding Progress, StringFormat='{}{0:0}%'}" FontSize="10" HorizontalAlignment="Right"/>
                                            </StackPanel>

                                            <!-- Error Section -->
                                            <StackPanel IsVisible="{Binding HasError}" Spacing="5" Margin="0,5,0,0">
                                                <TextBlock Text="{Binding ErrorMessage}" Foreground="#FF5555" FontSize="11" TextWrapping="Wrap" FontWeight="SemiBold"/>
                                            </StackPanel>
                                        </StackPanel>
                                        
                                        <StackPanel Grid.Column="1" VerticalAlignment="Center" Spacing="10" Margin="20,0,0,0">
                                            <Button Content="{Binding ActionButtonText}" 
                                                    Command="{Binding MainActionCommand}"
                                                    Theme="{StaticResource SmallGothicMetalButton}"
                                                    MinWidth="80"/>
                                            
                                            <!-- Variant Selector -->
                                            <ComboBox ItemsSource="{Binding Variants}" 
                                                      SelectedItem="{Binding SelectedVariant}"
                                                      IsVisible="{Binding HasVariants}"
                                                      Width="80"
                                                      IsEnabled="{Binding !IsProcessing}"
                                                      Theme="{StaticResource SmallGothicMetalComboBox}"/>
                                        </StackPanel>
                                    </Grid>
                                </Border>
                            </DataTemplate>
                        </ItemsControl.ItemTemplate>
                    </ItemsControl>
                </ScrollViewer>
            </TabItem>
            
            <!-- 關於 (About) -->
            <TabItem Header="{Binding [TabAbout], Source={x:Static services:LocalizationService.Instance}}">
                <StackPanel Spacing="10" Margin="10" HorizontalAlignment="Center" VerticalAlignment="Center">
                    <TextBlock Text="GimmeCapture!!" FontSize="24" FontWeight="Bold" Foreground="{DynamicResource AccentRedBrush}" HorizontalAlignment="Center"/>
                    <TextBlock Text="{Binding AppVersion, StringFormat='Version {0}'}" Foreground="White" HorizontalAlignment="Center"/>
                    <TextBlock Text="The One Tool to Snip &amp; Record" FontStyle="Italic" Foreground="{DynamicResource DeepRedBrush}" HorizontalAlignment="Center"/>
                    
                    <Button Content="{Binding [GitHubProject], Source={x:Static services:LocalizationService.Instance}}"
                            Theme="{StaticResource GothicMetalButton}"
                            HorizontalAlignment="Center"
                            Margin="0,10,0,0"
                            Command="{Binding OpenProjectCommand}"/>

                    <Button Content="{Binding [CheckForUpdates], Source={x:Static services:LocalizationService.Instance}}" 
                            Theme="{StaticResource GothicMetalButton}" 
                            HorizontalAlignment="Center" 
                            Margin="0,20,0,0"
                            Command="{Binding CheckUpdateCommand}"/>

                    <!-- Version Update Progress -->
                    <StackPanel IsVisible="{Binding UpdateService.IsDownloading}" Spacing="5" Margin="0,15,0,0" Width="300">
                        <ProgressBar Value="{Binding UpdateService.DownloadProgress}" Height="4" Foreground="{DynamicResource AccentRedBrush}" Minimum="0" Maximum="100"/>
                        <TextBlock Text="{Binding UpdateService.DownloadProgress, StringFormat='{}{0:0}%'}" FontSize="10" HorizontalAlignment="Right" Foreground="White" Opacity="0.8"/>
                    </StackPanel>
                </StackPanel>
            </TabItem>
        </TabControl>
        
        <!-- Bottom Actions -->
        <Border Grid.Row="1" BorderBrush="#1E1E1E" BorderThickness="0,1,0,0" Padding="0,10,0,0">
            <Grid ColumnDefinitions="Auto,*,Auto,Auto">
                <StackPanel Grid.Column="0" Orientation="Horizontal" Spacing="10">
                    <Button Content="{Binding [StartCapture], Source={x:Static services:LocalizationService.Instance}}" 
                            Theme="{StaticResource GothicMetalButton}" 
                            Command="{Binding StartCaptureCommand}" 
                            ToolTip.Tip="{Binding SnipTooltip}"/>
                </StackPanel>
                
                <TextBlock Grid.Column="1" 
                           Text="{Binding StatusText}" 
                           VerticalAlignment="Center" 
                           Margin="10,0" 
                           Foreground="{Binding IsModified, Converter={StaticResource ModifiedColorConverter}}" 
                           FontSize="11"/>

                <Button Grid.Column="2" Content="{Binding [SaveSettings], Source={x:Static services:LocalizationService.Instance}}" Theme="{StaticResource GothicMetalButton}" Margin="0,0,10,0" Command="{Binding SaveAndCloseCommand}"/>
                <Button Grid.Column="3" Content="{Binding [ResetDefault], Source={x:Static services:LocalizationService.Instance}}" Theme="{StaticResource GothicMetalButton}" Command="{Binding ResetToDefaultCommand}"/>
            </Grid>
        </Border>
    </Grid>
</Window>
